<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>gclib: Program Preprocessor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="galil_logo_doxygen.bmp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">gclib
   &#160;<span id="projectnumber">1.37.6</span>
   </div>
   <div id="projectbrief">Communications API for Galil controllers and PLCs</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('preprocessor.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Program Preprocessor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_markdown_preprocessor"></a> gclib's program downloader provides a preprocessor for DMC code. The preprocessor modifies the program prior to download providing a number of language features not present in native DMC code.</p>
<p>The preprocessor is invoked in the following two ways.</p>
<ol type="1">
<li>With both <a class="el" href="group__cpp__api_gacafe19b2dd0537ff458e3c8afe3acfeb.html#gacafe19b2dd0537ff458e3c8afe3acfeb" title="Downloads a program to the controller&#39;s program buffer.">GProgramDownload()</a> and <a class="el" href="group__cpp__api_ga289d1f698c5a8dcdfc86355fd0f2d3f7.html#ga289d1f698c5a8dcdfc86355fd0f2d3f7" title="Program download from file.">GProgramDownloadFile()</a> via the <code>preprocessor</code> argument. Downloading code with null for the preprocessor argument uses defaults.</li>
<li>From within DMC code via in-band preprocessor directives.</li>
</ol>
<hr  />
<h1>The <code>preprocessor</code> argument</h1>
<p><a class="el" href="group__cpp__api_gacafe19b2dd0537ff458e3c8afe3acfeb.html#gacafe19b2dd0537ff458e3c8afe3acfeb" title="Downloads a program to the controller&#39;s program buffer.">GProgramDownload()</a> and <a class="el" href="group__cpp__api_ga289d1f698c5a8dcdfc86355fd0f2d3f7.html#ga289d1f698c5a8dcdfc86355fd0f2d3f7" title="Program download from file.">GProgramDownloadFile()</a> can be called with a string passed to the <code>preprocessor</code> argument. The program will be modified based on this string prior to download. See <em>Preprocessor Options</em> below for syntax.</p>
<hr  />
<h1>In-band Operation</h1>
<p>DMC code can be written with special markup to signal the preprocessor to take actions prior to download.</p>
<p>For example, the following program will invoke the in-band preprocessor. The specifics are described below.</p>
<div class="fragment"><div class="line">## Author: Zaphod Beeblebrox</div>
<div class="line">## Project: Total Perspective Vortex</div>
<div class="line">//the above 4 hashmarks enable the preprocessor</div>
<div class="line">##option &quot;--min 4&quot; //use a minimum of level four compression</div>
<div class="line">REM REM-style comments are supported at all times</div>
<div class="line">PRA=1000</div>
<div class="line">BGA</div>
<div class="line">AMA</div>
<div class="line">EN</div>
</div><!-- fragment --><h2>The <code>REM</code> Comment</h2>
<p>Lines beginning with the string <code>REM</code> are removed prior to download. <code>REM</code> comments are always removed regardless of whether the other preprocessor options are enabled or not.</p>
<h2>Double Hash</h2>
<p>Most preprocessor statements begin with a double hash, <code>##</code>. When proceeded by a space, the double hash acts like a <code>REM</code> comment.</p>
<p>When proceeded by a character other than space, <code>##</code> is interpreted as a preprocessor directive. For example, see <code>##option</code> below.</p>
<dl class="section note"><dt>Note</dt><dd>Double hash lines are removed from the program only when the preprocessor is enabled with a quad hash.</dd></dl>
<h2>Quad Hash to enable</h2>
<p>In order to enable the in-band preprocessor, the first two lines of the DMC program must start with a double hash. This syntax of using two lines with double hashmarks is called a <em>quad hash</em>.</p>
<p>Content may follow the hash marks. For example, a good code writing style is to use double hash comments as a comment header showing author, project name, etc.</p>
<h2>C-style comments</h2>
<p>With the preprocessor enabled, C-style comments may be used with the <code>//</code> prefix. These comments are very similar to <code>REM</code> comments. The primary advantage of using this comment over <code>REM</code> is that <code>//</code> comments may occur anywhere in a line. This is helpful for line comments such as the following.</p>
<div class="fragment"><div class="line">SIA= 1,25,25,0&lt;4&gt;1 //SSI 25 bits total, all single turn, no status </div>
</div><!-- fragment --><p>Strings containing <code>//</code> are not interpreted as comments.</p>
<dl class="section note"><dt>Note</dt><dd><code>//</code> comments are removed from the program only when the preprocessor is enabled with a quad hash.</dd></dl>
<h2>Preprocessor Directives</h2>
<dl class="section note"><dt>Note</dt><dd>Directives are only followed when the preprocessor is enabled with a quad hash.</dd></dl>
<h3><code>##option</code></h3>
<p>The <code>option</code> directive allows passing switches directly to the preprocessor with the same syntax as the <code>preprocessor</code> argument in <a class="el" href="group__cpp__api_gacafe19b2dd0537ff458e3c8afe3acfeb.html#gacafe19b2dd0537ff458e3c8afe3acfeb" title="Downloads a program to the controller&#39;s program buffer.">GProgramDownload()</a> and <a class="el" href="group__cpp__api_ga289d1f698c5a8dcdfc86355fd0f2d3f7.html#ga289d1f698c5a8dcdfc86355fd0f2d3f7" title="Program download from file.">GProgramDownloadFile()</a>. The syntax of the <code>option</code> directive is the following.</p>
<div class="fragment"><div class="line">##option &quot;{preprocessor switches}&quot;</div>
</div><!-- fragment --><p>For example, the following line will disable compression in the program.</p>
<div class="fragment"><div class="line">##option &quot;--max 0&quot;</div>
</div><!-- fragment --><p>See <em>Preprocessor Options</em> below for other switches.</p>
<h3><code>##include</code></h3>
<p>The <code>include</code> directive provides a way to include the contents of another DMC file in the current program. This is useful for reusing code such as automatic subroutines, homing operations, or controller initilization routines.</p>
<p>The contents of the file will be inserted in place of the <code>include</code> line. The insertion occurs prior to code compression.</p>
<p>The syntax of the <code>include</code> directive is the following.</p>
<div class="fragment"><div class="line">##include &quot;{filename}&quot;</div>
</div><!-- fragment --><p>For example,</p>
<div class="fragment"><div class="line">##include &quot;c:\galil\initialize.dmc&quot;</div>
<div class="line">##include &quot;homing.dmc&quot;</div>
</div><!-- fragment --><p>To write more portable code, use the <code>include</code> directive with just the file name, no absolute path. The path to find the file on the system is set depending on usage.</p><ol type="1">
<li>In the <a href="http://galil.com/downloads/software/gdk">Galil Design Kit</a>, specify the include path in GDK's <a href="http://galil.com/sw/pub/all/doc/gdk/man/settings.html">settings</a> with the <code>--search</code> or <code>-I</code> switch as defined below.</li>
<li>When downloading code via <a class="el" href="group__cpp__api_gacafe19b2dd0537ff458e3c8afe3acfeb.html#gacafe19b2dd0537ff458e3c8afe3acfeb" title="Downloads a program to the controller&#39;s program buffer.">GProgramDownload()</a> or <a class="el" href="group__cpp__api_ga289d1f698c5a8dcdfc86355fd0f2d3f7.html#ga289d1f698c5a8dcdfc86355fd0f2d3f7" title="Program download from file.">GProgramDownloadFile()</a>, use the <code>--search</code> or <code>-I</code> switch in the <code>preprocessor</code> argument.</li>
<li>Finally, if the file is in the executable search path, the file will be found. However, one of the previous two options is more reliable.</li>
</ol>
<h3><code>##gclib</code></h3>
<p><a href="http://galil.com/downloads/software/gdk">Galil Design Kit</a> uses the <code>##gclib</code> directive in <a href="http://galil.com/sw/pub/all/doc/gdk/man/macros.html">GDK Macros</a>. gclib ignores this directive.</p>
<h2>In-band Support</h2>
<p>In addition to gclib, <a href="http://galil.com/downloads/software/gdk">Galil Design Kit</a> supports the preprocessor. Proper preprocessor usage will be colored in the Editor's syntax highlighter. If the quad hash is not present, preprocessor syntax will be colored differently to indicate improper usage.</p>
<p>The preprocessor is not supported in software prior to GDK/gclib. DMC code downloads using the in-band preprocessor in prior generation software (e.g. GalilTools or SmartTerm) will fail with a TC code of 61, <em>Duplicate or bad label</em>.</p>
<hr  />
<h1>Preprocessor Options</h1>
<h2>Compression, <code>--min</code>, <code>--max</code></h2>
<ul>
<li>Default uses minimum compression needed to fit the program.</li>
<li><code>--max</code> <em>n</em> provides compression up to and including level <em>n</em>. Only the necessary compression will be performed up to level <em>n</em>.</li>
<li><code>--min</code> <em>n</em> will compress at least up to and including <em>n</em>. <em>n</em> defined as with <code>--max</code>.</li>
</ul>
<h3>Compression Levels, <em>n</em></h3>
<ul>
<li>Level 0 (mandatory)<ol type="1">
<li>Remove lines beginning with <code>REM</code>.</li>
<li>Remove trailing semicolons.</li>
<li>Comment blank lines with '.</li>
<li>Remove white space (space/tab) in front of # (label declarations).</li>
<li>Remove white space after commands.</li>
<li>Line ends changed to carriage return.</li>
<li>Replace leading tabs with double space.</li>
<li>Replace non-leading tabs with single space.</li>
<li>A backslash (<code>\</code>) character on a line other than a preprocessor line will result in an error.</li>
</ol>
</li>
<li>Level 1<ol type="1">
<li>Remove unnecessary spaces. Strings, comments ('), and no-ops (NO) are not changed.</li>
</ol>
</li>
<li>Level 2<ol type="1">
<li>Remove comments (') but not no-ops (NO).</li>
</ol>
</li>
<li>Level 3<ol type="1">
<li>Remove no-ops (NO).</li>
</ol>
</li>
<li>Level 4<ol type="1">
<li>Break apart compound lines that are too long.</li>
<li>Compact lines of code to maximize line usage.</li>
<li>Use backtick to support long lines where applicable.</li>
</ol>
</li>
</ul>
<h2>Code insertion, <code>--insert</code></h2>
<ul>
<li>Default begins at line zero and overwrites anything present.</li>
<li><code>--insert</code> <em>arg</em> invokes the insert option of the firmware's <em>DL</em> command. <em>arg</em> can be one of the following.<ol type="1">
<li>Line number, e.g. <code>100</code>. Program insertion will occur on the line after the line specified.</li>
<li>Variable name, e.g. <code>myvar</code>. Program insertion will occur on the line after the line equal to the value of the variable.</li>
<li>Label callout, e.g. <code>#mylabel</code>. Program insertion will occur on the line after the label.</li>
<li>A lone <code>#</code> symbol. Program insertion will occur on the line after the last line in the program buffer.</li>
</ol>
</li>
<li>Compression directives <code>--max</code> and <code>--min</code> are followed.</li>
<li>All original code following the point of insertion is cleared.</li>
<li>Not all products support the <code>--insert</code> operation, e.g. DMC-30010. See the <a href="http://www.galil.com/download/comref/comall/index.html#download.html">DL</a> command for support.</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>It is the user's responsibility to ensure that the code will fit in the inserted location. The preprocessor will not check line numbers when executing the <code>--insert</code> option.</dd></dl>
<h2>Include Search Paths, <code>--search</code>, <code>-I</code></h2>
<ul>
<li>The <code>##include</code> directive will attempt to open its string argument directly. The open will succeed if the argument is the absolute path, or if the argument is in the executable's path, e.g. in the same directory.</li>
<li><code>--search</code> <em>path</em> allows the user to specify a directory or directories to be searched for the <code>include</code> file in case the first open fails.<ul>
<li>For historical reasons, <code>-I</code> is shorthand for <code>--search</code>.</li>
</ul>
</li>
<li>Multiple directories may be specified with multiple <code>-I</code> directives.</li>
<li>For in-band code, <code>-I</code> must be specified prior to the include.</li>
<li>A common use for <code>-I</code> is to specify only the filename in the DMC source code and use the <code>preprocessor</code> argument during download to specify the path to the files. This allows the files to be moved without a change to source code.</li>
<li>Search order<ol type="1">
<li>The <code>##include</code> argument is checked first as-is.</li>
<li>Then each <code>-I</code> argument in the <code>preprocessor</code> argument, in the order specified.</li>
<li>Then <code>##option</code> directives in the DMC file, in the order specified.</li>
</ol>
</li>
<li>If the search path contains spaces, enclose the path in double quotes, escaped with a backslash. See example below.</li>
</ul>
<h3>In-band Example</h3>
<div class="fragment"><div class="line">##option &quot;-I /code/dmc/homing&quot;</div>
<div class="line">##option &quot;-I \&quot;/code/dmc/other code\&quot;&quot;</div>
<div class="line">##include &quot;auto.dmc&quot; </div>
<div class="line">//executable&#39;s directory will be checked</div>
<div class="line">//then c:\code\dmc\homing</div>
<div class="line">//then c:\code\dmc\other code</div>
</div><!-- fragment --><h2>Macro Definition, <code>--define</code>, <code>-D</code></h2>
<ul>
<li><code>--define</code> provides a way to substitute one token for another. This is useful for writing code that is generic until program download. Wherever the token is found in code, it is substituted by the replacement. The replacement occurs right before code compression.</li>
<li><code>-D</code> is shorthand for <code>--define</code>.</li>
<li>The token should consist of a starting backslash character, followed by upper or lower case alphanumeric characters, underscores, and an ending backslash.</li>
<li>The common usage for this feature is to write code with a token, and then call the program download with the <code>-D</code> switch.</li>
</ul>
<p>In this example, an axis is defined at download time. Specifying the following for the preprocessor argument</p>
<div class="fragment"><div class="line">--define \ax\:A</div>
</div><!-- fragment --><p>would cause the following code</p>
<div class="fragment"><div class="line">SH\ax\</div>
<div class="line">JG\ax\=1000</div>
<div class="line">BG\ax\</div>
</div><!-- fragment --><p>to be downloaded as</p>
<div class="fragment"><div class="line">SHA</div>
<div class="line">JGA=1000</div>
<div class="line">BGA</div>
</div><!-- fragment --><p>This causes the <em>A</em> axis to be addressed.</p>
<dl class="section note"><dt>Note</dt><dd>The macro <code>\pid\</code> is reserved for exclusive use by GDK.</dd></dl>
<h2>Conditional Directives, <code>--ifdef</code>, <code>--ifndef</code></h2>
<p>To specify a preprocessor directive should be executed only if a macro is defined, use <code>--ifdef</code>.</p>
<div class="fragment"><div class="line">##option &quot;--ifdef \minify\ --min 4&quot; //maximally compress code if minify macro set</div>
</div><!-- fragment --><p>To specify a preprocessor directive should be executed only if a macro is NOT defined, use <code>--ifndef</code>.</p>
<div class="fragment"><div class="line">##option &quot;--ifndef \axis\ -D \axis\:A&quot; //Default to axis A</div>
</div><!-- fragment --><h1>GDK Support</h1>
<ul>
<li>See the <code>preprocessor</code> text box in the <em>Editor</em> settings page to set the desired preprocessor setting for developing in GDK's editor. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
	<li class="footer">Generated by <a href="http://www.galil.com">Galil Motion Control</a></li>
     <!--<li class="footer">Generated by
   <a href="http://www.doxygen.org/index.html">
     <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.1 </li> -->
  </ul>
</div>
</body>
</html>
